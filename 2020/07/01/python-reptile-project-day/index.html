<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Python爬虫-党史上的今天 | Hiram&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="分析  分析结构，可以发现标题都是h2标签，内容都是p标签，那就直接爬呗！！！  import requests  url &#x3D; &#39;http:&#x2F;&#x2F;cpc.people.com.cn&#x2F;GB&#x2F;64162&#x2F;64165&#x2F;67447&#x2F;67448&#x2F;index.html&#39; response &#x3D; requests.get(url) print(response.text)  发现中文乱码 查看编码结">
<meta property="og:type" content="article">
<meta property="og:title" content="Python爬虫-党史上的今天">
<meta property="og:url" content="https://hiram-wong.github.io/2020/07/01/python-reptile-project-day/index.html">
<meta property="og:site_name" content="Hiram&#39;s Blog">
<meta property="og:description" content="分析  分析结构，可以发现标题都是h2标签，内容都是p标签，那就直接爬呗！！！  import requests  url &#x3D; &#39;http:&#x2F;&#x2F;cpc.people.com.cn&#x2F;GB&#x2F;64162&#x2F;64165&#x2F;67447&#x2F;67448&#x2F;index.html&#39; response &#x3D; requests.get(url) print(response.text)  发现中文乱码 查看编码结">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/07/01/vWTBPN3bJ2sKYDt.png">
<meta property="og:image" content="https://i.loli.net/2020/07/01/Pxu5zMlmv8CwpZ2.png">
<meta property="og:image" content="https://i.loli.net/2020/07/01/Bi2DxKnIaZqztOc.png">
<meta property="og:image" content="https://i.loli.net/2020/07/01/zk4MjrxewLyOasY.png">
<meta property="og:image" content="https://i.loli.net/2020/07/01/WXBtLeDCVuHF2Ix.png">
<meta property="og:image" content="https://i.loli.net/2020/07/01/q8n3IbkiZcYDWvw.png">
<meta property="og:image" content="https://i.loli.net/2020/07/01/esR9Zp6P7C4r5Uh.png">
<meta property="article:published_time" content="2020-07-01T05:39:00.000Z">
<meta property="article:modified_time" content="2020-07-01T07:31:40.154Z">
<meta property="article:author" content="HiramWong">
<meta property="article:tag" content="Python爬虫-完整项目分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/07/01/vWTBPN3bJ2sKYDt.png">
  
    <link rel="icon" href="/images/favicon.ico">
  
  <!-- font-awesome -->
  <link href="//cdn.bootcdn.net/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.3/js/all.js"></script>
  <!-- jQuery -->
  <script src="//cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- valine评论 -->
  
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  
  <!-- 代码高亮库 -->
  <!-- <link href="//cdn.bootcdn.net/ajax/libs/highlight.js/11.0.1/styles/atom-one-dark.min.css" rel="stylesheet"> -->
  <script src="//cdn.bootcdn.net/ajax/libs/highlight.js/11.0.1/highlight.min.js"></script>
  <!-- <script src="//cdn.bootcdn.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script> -->

  
<link rel="stylesheet" href="/css/highlight.css">

  <script >
  hljs.highlightAll()
</script>
  
<link rel="stylesheet" href="/css/index.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">
      Hiram&#39;s Blog
    </a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
          
          <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">
            <i class="fab fa-dribbble"></i>
          </a>
          
        
          
          
          <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">
            <i class="fab fa-behance"></i>
          </a>
          
        
          
          
          <a href="https://www.instagram.com/clovertuan" target="_blank" class="nav-icn">
            <i class="fab fa-instagram"></i>
          </a>
          
        
          
          
          <a href="https://github.com/Hiram-Wong" target="_blank" class="nav-icn">
            <i class="fab fa-github"></i>
          </a>
          
        
      
      <span id="search">
        <i class="fas fa-search"></i>
      </span>
      <style>
        .search-active .search-pop-overlay {
          background: rgba(0,0,0,0.3);
          visibility: visible;
        }
        .search-pop-overlay {
          background: rgba(0,0,0,0);
          display: flex;
          height: 100%;
          left: 0;
          position: fixed;
          top: 0;
          transition: visibility 0.4s, background 0.4s;
          visibility: hidden;
          width: 100%;
          z-index: 1400;
        }
        .search-popup {
          background: #f5f5f5;
          border-radius: 5px;
          height: 80%;
          margin: auto;
          transform: scale(0);
          transition: transform 0.4s;
          width: 700px;
        }
        .search-popup .search-header {
          background: #eee;
          border-top-left-radius: 5px;
          border-top-right-radius: 5px;
          display: flex;
          padding: 5px;
          line-height: 2;
        }
        .search-popup .search-icon, .search-popup .popup-btn-close {
          color: #999;
          font-size: 18px;
          padding: 0 10px;
        }
        .search-popup .search-input-container {
          flex-grow: 1;
          padding: 2px;
        }
        .search-popup input.search-input {
          background: transparent;
          border: 0;
          outline: 0;
          width: 100%;
        }
        input {
          font-family: inherit;
          font-size: 100%;
          line-height: 1.15;
          margin: 0;
        }
        [type='search'] {
          outline-offset: -2px;
          -webkit-appearance: textfield;
        }
        .search-popup .popup-btn-close {
          cursor: pointer;
        }
        .search-popup .search-icon, .search-popup .popup-btn-close {
          color: #999;
          font-size: 18px;
          padding: 0 10px;
        }
        .search-popup .no-result {
            display: flex;
        }
        .search-popup .search-result-container {
            height: calc(100% - 55px);
            overflow: auto;
            padding: 5px 25px;
        }
        .search-popup .search-result-icon {
            color: #ccc;
            margin: auto;
        }
        hr {
          background-image: repeating-linear-gradient(-45deg, #ddd, #ddd 4px, transparent 4px, transparent 8px);
          border: 0;
          height: 3px;
          margin: 40px 0;
        }
        .search-popup .no-result {
          display: flex;
        }
        .search-popup .search-result-container hr {
          margin: 5px 0 10px;
        }
        .search-popup .search-result-list {
          width: 100%;
        }
        .search-popup .search-result-list {
          margin: 0 5px;
          padding: 0;
        }
        .search-popup p.search-result {
          border-bottom: 1px dashed #ccc;
          padding: 5px 0;
          white-space:nowrap;
          overflow:hidden;
          text-overflow:ellipsis;
        }
        .search-result em {
          background: transparent;
          border-bottom: 1px dashed #ff2a2a;
          color: #ff2a2a;
          font-weight: bold;
        }
        .search-popup a.search-result-title {
          font-weight: bold;
        }
        .search-popup a {
          border-bottom: 1px solid #999;
          color: #555;
          cursor: pointer;
          outline: 0;
          text-decoration: none;
          overflow-wrap: break-word;
        }
      </style>
      
      <div class="search-pop-overlay">
        <div class="popup search-popup">
          <div class="search-header">
            <span class="search-icon">
              <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
              <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input" id="local-search-input" >
              <!-- <input type="search" id="local-search-input" name="s" placeholder="请输入搜索的关键字" class="search-input"> -->
            </div>
            <span class="popup-btn-close" role="button">
              <i class="fa fa-times-circle"></i>
            </span>
          </div>
          <div class="search-result-container no-result"id="local-search-result">
            <!-- <div class="search-stats">48 results found</div> -->
            <!-- <hr> -->
            <div class="search-result-icon">
              <i class="fa fa-search fa-5x"></i>
            </div>
          </div>
        </div>
      </div>
      <div id="local-search1">
        <!-- <input type="search" id="local-search-input" name="s" placeholder="请输入搜索的关键字" class="search-input">
        <div id="local-search-result"></div> -->
        
<script src="/js/search.js"></script>

        <script type="text/javascript">      
          var search_path = "search.xml";
          if (search_path.length == 0) {
            search_path = "search.xml";
          }
          var path = "/" + search_path;
          searchFunc(path, 'local-search-input', 'local-search-result');
        </script>
      </div>
      <script>
      </script>
    </div>
    <div class="menu">
      
        
          <a href="/" class="nav-menu ">
            HOME
          </a>
          
        
          <a href="/archives" class="nav-menu ">
            ARCHIVE
          </a>
          
        
          <a href="/categories" class="nav-menu ">
            CATEGORIES
          </a>
          
        
          <a href="/tags" class="nav-menu ">
            TAGS
          </a>
          
        
          <a href="/links" class="nav-menu ">
            LINKS
          </a>
          
        
          <a href="/about" class="nav-menu ">
            ABOUT
          </a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">
    Python爬虫-党史上的今天
  </h2>
  <p class="sub">
    7月 1, 2020
  </p>
  <article class="content">
    <h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p><img src="https://i.loli.net/2020/07/01/vWTBPN3bJ2sKYDt.png" alt="TIM截图20200701153014.png"></p>
<ol>
<li>分析结构，可以发现标题都是h2标签，内容都是p标签，那就直接爬呗！！！</li>
</ol>
<pre><code class="python">import requests

url = &#39;http://cpc.people.com.cn/GB/64162/64165/67447/67448/index.html&#39;
response = requests.get(url)
print(response.text)
</code></pre>
<p><img src="https://i.loli.net/2020/07/01/Pxu5zMlmv8CwpZ2.png" alt="TIM截图20200701152711.png"><br>发现中文乱码</p>
<p><img src="https://i.loli.net/2020/07/01/Bi2DxKnIaZqztOc.png" alt="TIM截图20200701151957.png"><br>查看编码结果是GB2312，这就好办了，进行解码不就完事了</p>
<pre><code class="python">import requests

url = &#39;http://cpc.people.com.cn/GB/64162/64165/67447/67448/index.html&#39;
response = requests.get(url)
response.encoding = &#39;GB2312&#39;
print(response.text)
</code></pre>
<p>对比网页源代码发现内容一致，说明人民网没做任何反爬机制，这emmm</p>
<ol start="2">
<li>获取想要的内容</li>
</ol>
<pre><code class="python">import requests
from lxml import etree

url = f&#39;http://cpc.people.com.cn/GB/64162/64165/67447/67448/index.html&#39;
response = requests.get(url)
response.encoding = &#39;GB2312&#39;
# print(response.text)
html = etree.HTML(response.text)

title_pat = &#39;//div[@class=&quot;p1_content clearfix&quot;]/div[@class=&quot;p1_02 clearfix width884&quot;]/h2/text()&#39;
des_pat = &#39;//div[@class=&quot;p1_content clearfix&quot;]/div[@class=&quot;p1_02 clearfix width884&quot;]/p/text()&#39;
title = html.xpath(title_pat)
des = html.xpath(des_pat)
# 转换为元组
itemZip = zip(title, des)
# 转换为字典
content = dict(itemZip)
print(content)
</code></pre>
<ol start="3">
<li>我们不知想要当天的，我们还要其他的，分析网址</li>
</ol>
<pre><code class="url">http://cpc.people.com.cn/GB/64162/64165/67447/67448/index.html
http://cpc.people.com.cn/GB/64162/64165/67447/67449/index.html
http://cpc.people.com.cn/GB/64162/64165/67447/67450/index.html
http://cpc.people.com.cn/GB/64162/64165/67447/67458/index.html
http://cpc.people.com.cn/GB/64162/64165/67447/67506/index.html
</code></pre>
<p>发现前面几个还是有规律的，后面就乱序了，这。。，我们从按钮入手<br><img src="https://i.loli.net/2020/07/01/zk4MjrxewLyOasY.png" alt="TIM截图20200701152316.png"></p>
<p>发现<code>查看信息</code>按钮是通过JavaScript脚本go()函数执行的，接下来就是寻找go函数<br><img src="https://i.loli.net/2020/07/01/WXBtLeDCVuHF2Ix.png" alt="TIM截图20200701141453.png"></p>
<p>发现有2个位置有go()函数，点进去可以发现只有<code>cpc_review.js</code>才是我们想要的，找到JavaScript部分就好办了。<br><img src="https://i.loli.net/2020/07/01/q8n3IbkiZcYDWvw.png" alt="TIM截图20200701141732.png"></p>
<p>发现这不就是switch-case 语句，先通过第一个case分析月份再通过第二个case在定位到月份</p>
<p>显而易见链接前半部分都是相同的，后办部分为<code>月/日</code>，最终确认链接为<br><code>http://cpc.people.com.cn/GB/64162/64165/月/日/index.html</code></p>
<p>这就好办了 那就直接爬呗<br>但月份正则并不好提取，反正就12个月份，直接手撸呗！！！</p>
<p>上代码hhhh</p>
<pre><code class="python">import re
import requests

monuth = [76621, 77552, 77585, 78561, 79703, 82273, 67447, 68640, 70293, 70486, 72301, 74856]
day_list = []

for item in monuth:
    url = &#39;http://cpc.people.com.cn/img/2010cpc_lishishangdejintian/cpc_review.js&#39;
    response = requests.get(url).text
    url_pat = f&#39;http://cpc.people.com.cn/GB/64162/64165/&#123;item&#125;/(.*?)/index.html&#39;
    url = re.compile(url_pat).findall(response)
    day_list.append(url)

print(day_list)
</code></pre>
<h3 id="项目封装"><a href="#项目封装" class="headerlink" title="项目封装"></a>项目封装</h3><pre><code class="python"># 导入包
import re
import requests
import time
from lxml import etree

monuth_list = [76621, 77552, 77585, 78561, 79703, 82273, 67447, 68640, 70293, 70486, 72301, 74856]
day_list = []

def day():
    &#39;&#39;&#39;

    :return:
    &#39;&#39;&#39;
    for item in monuth_list:
        url = &#39;http://cpc.people.com.cn/img/2010cpc_lishishangdejintian/cpc_review.js&#39;
        response = requests.get(url).text
        url_pat = f&#39;http://cpc.people.com.cn/GB/64162/64165/&#123;item&#125;/(.*?)/index.html&#39;
        url = re.compile(url_pat).findall(response)
        day_list.append(url)
    # print(day_list)

def search(mon:int, day:int):
    &#39;&#39;&#39;
    搜索获取今日党史
    :param mon: 月
    :param day: 日
    :return: 内容
    &#39;&#39;&#39;
    mon = monuth_list[mon - 1]
    day = day_list[monuth_list.index(mon)][day - 1]
    url = f&#39;http://cpc.people.com.cn/GB/64162/64165/&#123;mon&#125;/&#123;day&#125;/index.html&#39;
    response = requests.get(url)
    response.encoding = &#39;GB2312&#39;
    html = etree.HTML(response.text)

    title_pat = &#39;//div[@class=&quot;p1_content clearfix&quot;]/div[@class=&quot;p1_02 clearfix width884&quot;]/h2/text()&#39;
    des_pat = &#39;//div[@class=&quot;p1_content clearfix&quot;]/div[@class=&quot;p1_02 clearfix width884&quot;]/p/text()&#39;
    title = html.xpath(title_pat)
    des = html.xpath(des_pat)
    itemZip = zip(title, des)

    # print(dict(itemZip))
    return dict(itemZip)

if __name__ == &#39;__main__&#39;:
    day()
    monuth = time.localtime().tm_mon
    day = time.localtime().tm_mday
    print(search(monuth, day))
</code></pre>
<h3 id="Flask分装api"><a href="#Flask分装api" class="headerlink" title="Flask分装api"></a>Flask分装api</h3><p><img src="https://i.loli.net/2020/07/01/esR9Zp6P7C4r5Uh.png" alt="TIM截图20200701151209.png"></p>
<pre><code class="python"># 导入包
import re
import requests
import time
from lxml import etree
from flask import Flask, request, json, Response

monuth_list = [76621, 77552, 77585, 78561, 79703, 82273, 67447, 68640, 70293, 70486, 72301, 74856]
day_list = []


def day():
    &#39;&#39;&#39;

    :return:
    &#39;&#39;&#39;
    for item in monuth_list:
        url = &#39;http://cpc.people.com.cn/img/2010cpc_lishishangdejintian/cpc_review.js&#39;
        response = requests.get(url).text
        url_pat = f&#39;http://cpc.people.com.cn/GB/64162/64165/&#123;item&#125;/(.*?)/index.html&#39;
        url = re.compile(url_pat).findall(response)
        day_list.append(url)


def search(mon, day):
    &#39;&#39;&#39;
    搜索获取今日党史
    :param mon: 月
    :param day: 日
    :return: 内容
    &#39;&#39;&#39;
    mon = monuth_list[int(mon) - 1]
    day = day_list[monuth_list.index(int(mon))][int(day) - 1]
    url = f&#39;http://cpc.people.com.cn/GB/64162/64165/&#123;mon&#125;/&#123;day&#125;/index.html&#39;
    response = requests.get(url)
    response.encoding = &#39;GB2312&#39;
    html = etree.HTML(response.text)

    title_pat = &#39;//div[@class=&quot;p1_content clearfix&quot;]/div[@class=&quot;p1_02 clearfix width884&quot;]/h2/text()&#39;
    des_pat = &#39;//div[@class=&quot;p1_content clearfix&quot;]/div[@class=&quot;p1_02 clearfix width884&quot;]/p/text()&#39;
    title = html.xpath(title_pat)
    des = html.xpath(des_pat)
    itemZip = zip(title, des)

    # print(dict(itemZip))
    return dict(itemZip)


app = Flask(__name__)


@app.route(&#39;/&#39;)
def index():
    mon = request.args.get(&quot;mon&quot;)
    day = request.args.get(&quot;day&quot;)
    if mon == None or day == None:
        mon = time.localtime().tm_mon
        day = time.localtime().tm_mday
    print(mon, day)
    res = &#123;
        &#39;code&#39;: 0,
        &#39;tips&#39;: &#39;获取成功&#39;,
        &#39;data&#39;: search(mon, day)
    &#125;
    return Response(json.dumps(res, ensure_ascii=False), mimetype=&#39;application/json&#39;)


if __name__ == &#39;__main__&#39;:
    day()
    app.run()
</code></pre>

  </article>
  <div class="Last-Next">
    
      <a href="/2020/08/05/development-cloudcloud-dev/">
        <div class="last">
          <span>上一篇</span>
          <p>
            云开发7天训练营学习
          </p>
        </div>
      </a>
      

    
      <a href="/2020/04/27/python-reptile-SQLAlchemy/">
        <div class="next">
          <span>下一篇</span>
          <p>
            Python爬虫-SQLAlchemy模块
          </p>
        </div>
      </a>
      
  </div>
</section>

<section class="article">
  
    <div id="vcomments"></div>
    
</section></div>
    <footer id="footer" class="f-cf">
  <div class="left">
    <span>© 2021 Hiram&#39;s Blog.</span>
    <span>Theme by Clover 2.0</span>
  </div>

  <div class="right">
    
      <p id="hitokoto"><a href="#" id="hitokoto_text">:D 获取中...</a></p>
      <script>
        var xhr = new XMLHttpRequest();
        xhr.open('get', '//v1.hitokoto.cn');
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            var data = JSON.parse(xhr.responseText);
            var hitokoto = document.getElementById('hitokoto_text');
            hitokoto.href = '//hitokoto.cn/?uuid=' + data.uuid
            hitokoto.innerText = data.hitokoto;
          }
        }
        xhr.send();
      </script>
    
  </div>
</footer>


<script src="/js/gotop.js"></script>


<div class="goTop" id="js-go_top">
	<span>
		<i class="fas fa-angle-up"></i>
	</span>
</div>

<script>
	$('#js-go_top').gotoTop({ offset: 500, speed: 300, animationShow: { 'transform': 'translate(0,0)', 'transition': 'transform .5s ease-in-out' }, animationHide: { 'transform': 'translate(100px,0)', 'transition': 'transform .5s ease-in-out' } });
</script>


  <script>
    new Valine({
      el: '#vcomments',
      appId: 'iXLhz5jeT2wFRfJCQAJ7V95C-gzGzoHsz',
      appKey: 'BfEnKf3O35FL0MPe3gVObgvU',
      placeholder: 'Your commnet here. Be cool.' || 'Your commnet here. Be cool.',
      avatar: 'mp' || 'mp',
      pageSize: '10' || 10,
      visitor: 'true',
    })
  </script>

  </div>
</body>
</html>